@import "tailwindcss";

/* Block printing — blank page */
@media print {
  html, body, body * { display: none !important; visibility: hidden !important; }
}

@theme inline {
  --color-background: var(--bg);
  --color-foreground: var(--fg);
  --color-surface: var(--srf);
  --color-border: var(--bdr);
  --color-muted: var(--mtd);
  --color-accent: var(--acc);
  --font-sans: var(--font-dm-sans);
  --font-heading: var(--font-heading);
}

/* Dark theme (default) */
html, html[data-theme="dark"] {
  --bg: #141414;
  --fg: #FAFAFA;
  --srf: #181818;
  --bdr: #2C2C2C;
  --mtd: #A1A1A1;
  --acc: #FCAA26;
  --acc-rgb: 252, 170, 38;
}

/* Light theme */
html[data-theme="light"] {
  --bg: #F9F9F9;
  --fg: #141414;
  --srf: #F0F0F0;
  --bdr: #E5E5E5;
  --mtd: #737373;
  --acc: #E09500;
  --acc-rgb: 224, 149, 0;
}

/* === Accent color overrides === */
html[data-accent="blue"]                        { --acc: #3B82F6; --acc-rgb: 59, 130, 246; }
html[data-theme="light"][data-accent="blue"]    { --acc: #2563EB; --acc-rgb: 37, 99, 235; }
html[data-accent="green"]                       { --acc: #22C55E; --acc-rgb: 34, 197, 94; }
html[data-theme="light"][data-accent="green"]   { --acc: #16A34A; --acc-rgb: 22, 163, 74; }
html[data-accent="purple"]                      { --acc: #A855F7; --acc-rgb: 168, 85, 247; }
html[data-theme="light"][data-accent="purple"]  { --acc: #9333EA; --acc-rgb: 147, 51, 234; }
html[data-accent="red"]                         { --acc: #EF4444; --acc-rgb: 239, 68, 68; }
html[data-theme="light"][data-accent="red"]     { --acc: #DC2626; --acc-rgb: 220, 38, 38; }
html[data-accent="pink"]                        { --acc: #EC4899; --acc-rgb: 236, 72, 153; }
html[data-theme="light"][data-accent="pink"]    { --acc: #DB2777; --acc-rgb: 219, 39, 119; }
html[data-accent="teal"]                        { --acc: #14B8A6; --acc-rgb: 20, 184, 166; }
html[data-theme="light"][data-accent="teal"]    { --acc: #0D9488; --acc-rgb: 13, 148, 136; }

/* === Chat density === */
html[data-density="compact"] .msg-bubble  { padding-top: 0.375rem; padding-bottom: 0.375rem; margin-bottom: 0.125rem; }
html[data-density="compact"] .msg-bubble-spaced { margin-bottom: 0.375rem; }
html[data-density="comfortable"] .msg-bubble  { padding-top: 0.875rem; padding-bottom: 0.875rem; margin-bottom: 0.375rem; }
html[data-density="comfortable"] .msg-bubble-spaced { margin-bottom: 1rem; }

/* Tab slide-in animation */
@keyframes tab-enter {
  from { opacity: 0; transform: translateX(12px); }
  to { opacity: 1; transform: translateX(0); }
}

@utility animate-tab-enter {
  animation: tab-enter 0.25s ease-out both;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
  20%, 40%, 60%, 80% { transform: translateX(4px); }
}

@keyframes fade-in {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slide-up {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes fade-scale {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}

@keyframes pulse-dot {
  0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
  40% { opacity: 1; transform: scale(1); }
}

/* Slide down for menus/dropdowns */
@keyframes slide-down {
  from { opacity: 0; transform: translateY(-8px) scale(0.98); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

/* Pop in for action buttons */
@keyframes pop-in {
  0% { opacity: 0; transform: scale(0.6); }
  70% { transform: scale(1.05); }
  100% { opacity: 1; transform: scale(1); }
}

/* Subtle glow pulse */
@keyframes glow-pulse {
  0%, 100% { box-shadow: 0 0 8px 0 rgba(var(--acc-rgb), 0.15); }
  50% { box-shadow: 0 0 20px 4px rgba(var(--acc-rgb), 0.25); }
}

/* Message send fly-out */
@keyframes send-fly {
  0% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.6; transform: scale(0.85) translateY(-2px); }
  100% { opacity: 1; transform: scale(1); }
}

/* Highlight flash for scrolled-to messages — double-pulse */
@keyframes highlight-flash {
  0% { background-color: rgba(var(--acc-rgb), 0.2); box-shadow: inset 0 0 0 1px rgba(var(--acc-rgb), 0.3); }
  25% { background-color: rgba(var(--acc-rgb), 0.08); }
  50% { background-color: rgba(var(--acc-rgb), 0.18); }
  100% { background-color: transparent; box-shadow: none; }
}

@utility animate-shake {
  animation: shake 0.5s ease-in-out;
}

@utility animate-fade-in {
  animation: fade-in 0.2s ease-out both;
}

@utility animate-slide-up {
  animation: slide-up 0.25s ease-out both;
}

@utility animate-fade-scale {
  animation: fade-scale 0.15s ease-out both;
}

@utility animate-slide-down {
  animation: slide-down 0.2s ease-out both;
}

@utility animate-pop-in {
  animation: pop-in 0.25s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

@utility animate-glow-pulse {
  animation: glow-pulse 2s ease-in-out infinite;
}

@utility animate-send-fly {
  animation: send-fly 0.35s ease-out;
}

@utility animate-highlight {
  animation: highlight-flash 2s ease-out forwards;
}

html, body {
  height: 100%;
  height: 100dvh;
}

body {
  background: var(--bg);
  color: var(--fg);
  font-family: var(--font-sans), system-ui, sans-serif;
  /* Safe area insets for notched devices */
  padding-left: env(safe-area-inset-left, 0px);
  padding-right: env(safe-area-inset-right, 0px);
}

/* Prevent iOS input zoom - ensure all inputs are at least 16px */
@media screen and (max-width: 768px) {
  input, textarea, select {
    font-size: 16px !important;
  }
}

/* Dark theme scrollbar */
html[data-theme="dark"] ::-webkit-scrollbar,
html:not([data-theme]) ::-webkit-scrollbar {
  width: 6px;
}
html[data-theme="dark"] ::-webkit-scrollbar-track,
html:not([data-theme]) ::-webkit-scrollbar-track {
  background: transparent;
}
html[data-theme="dark"] ::-webkit-scrollbar-thumb,
html:not([data-theme]) ::-webkit-scrollbar-thumb {
  background: #2C2C2C;
  border-radius: 3px;
}
html[data-theme="dark"] ::-webkit-scrollbar-thumb:hover,
html:not([data-theme]) ::-webkit-scrollbar-thumb:hover {
  background: #3A3A3A;
}

/* Light theme scrollbar */
html[data-theme="light"] ::-webkit-scrollbar {
  width: 6px;
}
html[data-theme="light"] ::-webkit-scrollbar-track {
  background: transparent;
}
html[data-theme="light"] ::-webkit-scrollbar-thumb {
  background: #D4D4D4;
  border-radius: 3px;
}
html[data-theme="light"] ::-webkit-scrollbar-thumb:hover {
  background: #A3A3A3;
}

/* Gentle float for empty states */
@keyframes gentle-float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}

@utility animate-gentle-float {
  animation: gentle-float 3s ease-in-out infinite;
}

/* Shimmer effect for skeleton loading */
@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

@utility animate-shimmer {
  background: linear-gradient(90deg, var(--srf) 25%, var(--bdr) 50%, var(--srf) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s ease-in-out infinite;
}

/* Staggered entry for lists */
@utility stagger-1 { animation-delay: 0.05s; }
@utility stagger-2 { animation-delay: 0.1s; }
@utility stagger-3 { animation-delay: 0.15s; }
@utility stagger-4 { animation-delay: 0.2s; }

/* Green glow for online indicator */
@utility glow-green {
  box-shadow: 0 0 6px 1px rgba(52, 211, 153, 0.4);
}

/* Pulsing dashed border for drag */
@keyframes pulse-border {
  0%, 100% { border-color: var(--acc); opacity: 1; }
  50% { border-color: var(--mtd); opacity: 0.7; }
}

@utility animate-pulse-border {
  animation: pulse-border 1.2s ease-in-out infinite;
}

/* Online status pulse */
@keyframes online-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

@utility animate-online-pulse {
  animation: online-pulse 2s ease-in-out infinite;
}


/* Chat font size preferences */
html[data-font-size="small"] .msg-text { font-size: 0.8125rem; }
html[data-font-size="large"] .msg-text { font-size: 0.9375rem; }

/* Text selection color */
::selection {
  background: var(--acc);
  color: var(--bg);
}

/* Focus-visible ring */
:focus-visible {
  outline: 2px solid var(--acc);
  outline-offset: 2px;
}

input:focus-visible,
textarea:focus-visible {
  outline: none;
}

/* Mobile: active tap feedback */
@media (hover: none) {
  button:active {
    opacity: 0.7;
  }
  /* Prevent text selection on long-press for action areas */
  .no-select {
    -webkit-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
  }
}

/* Mobile action sheet for message actions */
@keyframes slide-up-sheet {
  from { opacity: 0; transform: translateY(100%); }
  to { opacity: 1; transform: translateY(0); }
}

@utility animate-slide-up-sheet {
  animation: slide-up-sheet 0.25s cubic-bezier(0.32, 0.72, 0, 1) both;
}

/* Mobile: hide scrollbars for touch scrolling */
@media (pointer: coarse) {
  ::-webkit-scrollbar {
    display: none;
  }
  * {
    scrollbar-width: none;
  }
}

/* Smooth theme color transitions — @layer base so Tailwind utilities can override */
@layer base {
  body, body * {
    transition: background-color 0.15s ease, color 0.15s ease, border-color 0.15s ease;
  }
}

/* === Chat bubble styles === */
html[data-bubble-style="minimal"] .msg-bubble-content {
  background: transparent !important;
  border: none !important;
  border-left: 2px solid var(--bdr) !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  padding-left: 0.75rem !important;
}
html[data-bubble-style="minimal"] .msg-bubble-sent {
  background: transparent !important;
  border: none !important;
  border-right: 2px solid var(--acc) !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  color: var(--fg) !important;
  padding-right: 0.75rem !important;
}
html[data-bubble-style="classic"] .msg-bubble-content,
html[data-bubble-style="classic"] .msg-bubble-sent {
  border-radius: 4px !important;
}

/* Reduce motion for accessibility */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Explicit reduce motion override */
html[data-reduce-motion="true"] *,
html[data-reduce-motion="true"] *::before,
html[data-reduce-motion="true"] *::after {
  animation-duration: 0.01ms !important;
  animation-iteration-count: 1 !important;
  transition-duration: 0.01ms !important;
  scroll-behavior: auto !important;
}

/* Settings item stagger animation */
@keyframes settings-item-enter {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

@utility animate-settings-item {
  animation: settings-item-enter 0.3s ease-out both;
}

/* Toast enter/exit */
@keyframes toast-in {
  0% { opacity: 0; transform: translateY(12px) scale(0.95); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

@utility animate-toast-in {
  animation: toast-in 0.25s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

/* Offline banner slide */
@keyframes slide-down-banner {
  from { opacity: 0; transform: translateY(-100%); }
  to { opacity: 1; transform: translateY(0); }
}

@utility animate-slide-down-banner {
  animation: slide-down-banner 0.3s ease-out both;
}

/* Slide in from right for panels */
@keyframes slide-in-right {
  from { opacity: 0; transform: translateX(100%); }
  to { opacity: 1; transform: translateX(0); }
}

@utility animate-slide-in-right {
  animation: slide-in-right 0.25s cubic-bezier(0.32, 0.72, 0, 1) both;
}

/* Poll fill animation */
@keyframes poll-fill {
  from { width: 0%; }
}

@utility animate-poll-fill {
  animation: poll-fill 0.5s ease-out both;
}

/* Spring bounce entrance */
@keyframes spring-in {
  0% { opacity: 0; transform: scale(0.5); }
  50% { transform: scale(1.08); }
  70% { transform: scale(0.96); }
  100% { opacity: 1; transform: scale(1); }
}

@utility animate-spring-in {
  animation: spring-in 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

/* SVG checkmark draw animation */
@keyframes draw-check {
  0% { stroke-dashoffset: 30; }
  100% { stroke-dashoffset: 0; }
}

@utility animate-draw-check {
  stroke-dasharray: 30;
  stroke-dashoffset: 0;
  animation: draw-check 0.4s ease-out both;
}

/* Button shimmer sweep */
@keyframes shimmer-sweep {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* Slow floating animation for background orbs */
@keyframes float-slow {
  0%, 100% { transform: translate(0, 0) scale(1); }
  33% { transform: translate(10px, -15px) scale(1.02); }
  66% { transform: translate(-8px, 10px) scale(0.98); }
}

@utility animate-float-slow {
  animation: float-slow 8s ease-in-out infinite;
}

/* Smooth collapse/expand for form sections */
@keyframes collapse-fade-in {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 1; transform: translateY(0); }
}

.collapsible {
  display: grid;
  grid-template-rows: 0fr;
  transition: grid-template-rows 0.35s cubic-bezier(0.32, 0.72, 0, 1), opacity 0.25s ease;
  opacity: 0;
}

.collapsible.open {
  grid-template-rows: 1fr;
  opacity: 1;
}

.collapsible > .collapsible-inner {
  overflow: hidden;
}

/* FAB entrance animation */
@keyframes fab-in {
  from { opacity: 0; transform: scale(0.8) translateY(8px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

@utility animate-fab-in {
  animation: fab-in 0.25s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

/* Toast progress bar shrink */
@keyframes shrink-bar {
  from { width: 100%; }
  to { width: 0%; }
}

@utility animate-shrink-bar {
  animation: shrink-bar linear forwards;
}

/* Reaction pop animation */
@keyframes reaction-pop {
  0% { transform: scale(0.6); opacity: 0; }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); opacity: 1; }
}

@utility animate-reaction-pop {
  animation: reaction-pop 0.25s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

/* Bounce once for emoji in active reaction */
@keyframes bounce-once {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.3); }
}

@utility animate-bounce-once {
  animation: bounce-once 0.3s ease-out;
}

/* Glass morphism utility */
@utility glass {
  background: color-mix(in srgb, var(--bg) 80%, transparent);
  backdrop-filter: blur(12px) saturate(1.2);
  -webkit-backdrop-filter: blur(12px) saturate(1.2);
}

/* Heart pop animation for double-tap to like */
@keyframes heart-pop {
  0% { opacity: 0; transform: scale(0); }
  15% { opacity: 1; transform: scale(1.3); }
  30% { transform: scale(0.95); }
  45% { transform: scale(1.1); }
  80% { opacity: 1; transform: scale(1); }
  100% { opacity: 0; transform: scale(1) translateY(-20px); }
}

@utility animate-heart-pop {
  animation: heart-pop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

/* Badge bounce on count change */
@keyframes badge-bounce {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }
  100% { transform: scale(1); }
}

@utility animate-badge-bounce {
  animation: badge-bounce 0.3s ease-out;
}

/* Lightbox navigation button hover effect */
@keyframes nav-pulse {
  0%, 100% { background-color: rgba(255, 255, 255, 0.1); }
  50% { background-color: rgba(255, 255, 255, 0.2); }
}

/* Scroll shadow edges */
.scroll-shadow-top {
  mask-image: linear-gradient(to bottom, transparent, black 2rem);
}
.scroll-shadow-bottom {
  mask-image: linear-gradient(to top, transparent, black 2rem);
}

/* === Code Syntax Highlighting (hljs) === */
/* Dark theme tokens */
html, html[data-theme="dark"] {
  .hljs { color: #abb2bf; }
  .hljs-keyword, .hljs-selector-tag, .hljs-literal { color: #c678dd; }
  .hljs-string, .hljs-addition { color: #98c379; }
  .hljs-number { color: #d19a66; }
  .hljs-built_in, .hljs-type { color: #e5c07b; }
  .hljs-comment, .hljs-quote { color: #5c6370; font-style: italic; }
  .hljs-title, .hljs-section { color: #61afef; }
  .hljs-attr, .hljs-attribute { color: #d19a66; }
  .hljs-name, .hljs-tag { color: #e06c75; }
  .hljs-variable, .hljs-template-variable { color: #e06c75; }
  .hljs-regexp, .hljs-link { color: #56b6c2; }
  .hljs-meta { color: #61afef; }
  .hljs-deletion { color: #e06c75; }
  .hljs-symbol, .hljs-bullet { color: #56b6c2; }
  .hljs-params { color: #abb2bf; }
  .hljs-punctuation { color: #abb2bf; }
}

/* Light theme tokens */
html[data-theme="light"] {
  .hljs { color: #383a42; }
  .hljs-keyword, .hljs-selector-tag, .hljs-literal { color: #a626a4; }
  .hljs-string, .hljs-addition { color: #50a14f; }
  .hljs-number { color: #986801; }
  .hljs-built_in, .hljs-type { color: #c18401; }
  .hljs-comment, .hljs-quote { color: #a0a1a7; font-style: italic; }
  .hljs-title, .hljs-section { color: #4078f2; }
  .hljs-attr, .hljs-attribute { color: #986801; }
  .hljs-name, .hljs-tag { color: #e45649; }
  .hljs-variable, .hljs-template-variable { color: #e45649; }
  .hljs-regexp, .hljs-link { color: #0184bc; }
  .hljs-meta { color: #4078f2; }
  .hljs-deletion { color: #e45649; }
  .hljs-symbol, .hljs-bullet { color: #0184bc; }
  .hljs-params { color: #383a42; }
  .hljs-punctuation { color: #383a42; }
}
